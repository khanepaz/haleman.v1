<!DOCTYPE html>
<html lang="fa" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø­Ø§Ù„ Ù…Ù† â€” Ø±Ø¯ÛŒØ§Ø¨ Ø®Ù„Ù‚ Ùˆ Ø®Ùˆ</title>
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <!-- Google Fonts - Vazirmatn -->
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="manifest" href="manifest.json">
    <style>
        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: hsla(0, 100%, 50%, 1);
            background-image:
                radial-gradient(at 40% 20%, hsla(28, 100%, 74%, 1) 0px, transparent 50%),
                radial-gradient(at 80% 0%, hsla(189, 100%, 56%, 1) 0px, transparent 50%),
                radial-gradient(at 0% 50%, hsla(355, 100%, 93%, 1) 0px, transparent 50%),
                radial-gradient(at 80% 50%, hsla(340, 100%, 76%, 1) 0px, transparent 50%),
                radial-gradient(at 0% 100%, hsla(22, 100%, 77%, 1) 0px, transparent 50%),
                radial-gradient(at 80% 100%, hsla(242, 100%, 70%, 1) 0px, transparent 50%),
                radial-gradient(at 0% 0%, hsla(343, 100%, 76%, 1) 0px, transparent 50%);
            min-height: 100vh;
            padding: 10px 0;
            margin: 0;
        }

        .card {
            border-radius: 16px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 16px;
        }

        .mood-img {
            width: 120px;
            height: 120px;
            object-fit: contain;
            transition: transform 0.3s ease;
            margin: 16px auto;
        }

        @media (min-width: 768px) {
            .mood-img {
                width: 150px;
                height: 150px;
            }
        }

        .slider-container {
            margin: 20px 0;
        }

        .mood-label {
            font-size: 12px;
            font-weight: 500;
        }

        @media (min-width: 768px) {
            .mood-label {
                font-size: 14px;
            }
        }

        .mood-display {
            font-size: 24px;
            font-weight: 700;
            margin: 12px 0;
            transition: all 0.3s ease;
        }

        @media (min-width: 768px) {
            .mood-display {
                font-size: 28px;
            }
        }

        .btn-save {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            border: none;
            font-weight: 700;
            padding: 12px;
            font-size: 16px;
        }

        .btn-save:hover {
            background: linear-gradient(45deg, #ff5252, #e04e1a);
        }

        .btn-report {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            border: none;
            font-weight: 700;
            padding: 12px;
            font-size: 16px;
        }

        .btn-report:hover {
            background: linear-gradient(45deg, #3bb7ac, #3a8a7a);
        }

        .chart-container {
            background: white;
            padding: 16px;
            border-radius: 12px;
            margin: 16px 0;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }

        @media (min-width: 768px) {
            .chart-container {
                padding: 20px;
                border-radius: 15px;
            }
        }

        .reason-tag {
            cursor: pointer;
            transition: all 0.2s;
            padding: 8px 14px;
            border-radius: 50px;
            margin: 4px;
            display: inline-block;
            font-size: 13px;
            border: 2px solid #e9ecef;
            color: black;
            background: white;
        }

        @media (min-width: 768px) {
            .reason-tag {
                padding: 10px 16px;
                font-size: 14px;
            }
        }

        .reason-tag:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
        }

        .reason-tag.active {
            background: #007bff;
            color: white;
            border-color: #0056b3;
            box-shadow: 0 3px 8px rgba(0, 123, 255, 0.25);
        }

        #custom-reason {
            display: none;
            font-size: 14px;
            padding: 8px 12px;
        }

        .pagination .page-item.active .page-link {
            background-color: #007bff;
            border-color: #007bff;
            font-size: 14px;
        }

        .pagination .page-link {
            padding: 4px 10px;
            font-size: 13px;
        }

        @media (min-width: 768px) {
            .pagination .page-link {
                padding: 6px 12px;
                font-size: 14px;
            }
        }

        .mood-badge {
            font-weight: 600;
            padding: 0.3em 0.7em;
            border-radius: 50px;
            font-size: 13px;
        }

        @media (min-width: 768px) {
            .mood-badge {
                padding: 0.4em 0.8em;
                font-size: 14px;
            }
        }

        .chart-small {
            height: 200px !important;
        }

        @media (min-width: 768px) {
            .chart-small {
                height: 250px !important;
            }
        }

        .table th,
        .table td {
            padding: 8px;
            font-size: 13px;
        }

        @media (min-width: 768px) {

            .table th,
            .table td {
                padding: 12px;
                font-size: 14px;
            }
        }

        .modal-body .fa-3x {
            font-size: 2.5rem;
        }

        @media (min-width: 768px) {
            .modal-body .fa-3x {
                font-size: 3rem;
            }
        }

        .container {
            padding: 0 12px;
        }

        @media (min-width: 576px) {
            .container {
                max-width: 540px;
            }
        }

        @media (min-width: 768px) {
            .container {
                max-width: 720px;
            }
        }

        .nav-tabs .nav-link {
            font-size: 14px;
            padding: 8px 8px;
        }

        @media (min-width: 768px) {
            .nav-tabs .nav-link {
                font-size: 16px;
                padding: 10px 16px;
            }
        }

        #reportTabs {
            padding-right: 14px !important;
        }

        /* Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø±Ø´Ø¯ Ø¨ÛŒâ€ŒÙ†Ù‡Ø§ÛŒØª Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§ */
        .chart-container canvas {
            max-height: 300px;
            height: auto !important;
        }

        .mood-img {
            border-radius: 20px;
        }

        /* --- Ø§Ø³ØªØ§ÛŒÙ„ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø§Ø³Ù„Ø§ÛŒØ¯Ø± Ø¬Ø°Ø§Ø¨ --- */

        /* 1. Ø±ÛŒØ³Øª Ú©Ø±Ø¯Ù† Ø¸Ø§Ù‡Ø± Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø§Ø³Ù„Ø§ÛŒØ¯Ø± */
        #mood-slider {
            -webkit-appearance: none;
            /* Ø¨Ø±Ø§ÛŒ Ù…Ø±ÙˆØ±Ú¯Ø±Ù‡Ø§ÛŒ Ú©Ø±ÙˆÙ…ØŒ Ø³Ø§ÙØ§Ø±ÛŒ Ùˆ Ø§Ø¬ */
            appearance: none;
            width: 100%;
            background: transparent;
            /* Ø­Ø°Ù Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ */
            cursor: pointer;
            height: 24px;
            /* Ø§ÙØ²Ø§ÛŒØ´ Ø§Ø±ØªÙØ§Ø¹ Ø¨Ø±Ø§ÛŒ Ú©Ù„ÛŒÚ© Ø±Ø§Ø­Øªâ€ŒØªØ± */
        }

        /* 2. Ø§Ø³ØªØ§ÛŒÙ„ Ø¯Ø§Ø¯Ù† Ø¨Ù‡ Ù†ÙˆØ§Ø± Ø§ØµÙ„ÛŒ (Track) */
        #mood-slider::-webkit-slider-runnable-track {
            height: 10px;
            border-radius: 5px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            /* Ø§ÛŒÙ† Ú¯Ø±Ø§Ø¯ÛŒØ§Ù† Ù‡Ù…Ø§Ù† Ø±Ù†Ú¯â€ŒÙ‡Ø§ÛŒÛŒ Ø§Ø³Øª Ú©Ù‡ Ø´Ù…Ø§ Ø®ÙˆØ§Ø³ØªÛŒØ¯ */
            background: linear-gradient(to right,
                    #d9534f,
                    /* Ø§ÙØªØ¶Ø§Ø­ - Ù‚Ø±Ù…Ø² */
                    #f0ad4e,
                    /* Ø¨Ø¯ - Ù†Ø§Ø±Ù†Ø¬ÛŒ */
                    #ffc107,
                    /* Ù…Ø¹Ù…ÙˆÙ„ÛŒ - Ø²Ø±Ø¯ */
                    #5cb85c,
                    /* Ø®ÙˆØ¨ - Ø³Ø¨Ø² Ø±ÙˆØ´Ù† */
                    #28a745
                    /* Ø¹Ø§Ù„ÛŒ - Ø³Ø¨Ø² Ù¾Ø±Ø±Ù†Ú¯ */
                );
        }

        #mood-slider::-moz-range-track {
            height: 10px;
            border-radius: 5px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            background: linear-gradient(to right,
                    #28a745,
                    #5cb85c,
                    #ffc107,
                    #f0ad4e,
                    #d9534f);
        }

        /* 3. Ø§Ø³ØªØ§ÛŒÙ„ Ø¯Ø§Ø¯Ù† Ø¨Ù‡ Ø¯Ø³ØªÚ¯ÛŒØ±Ù‡ (Thumb) */
        #mood-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            margin-top: -7px;
            /* Ø¨Ø±Ø§ÛŒ Ù‚Ø±Ø§Ø± Ú¯Ø±ÙØªÙ† Ø¯Ù‚ÛŒÙ‚ Ø¯Ø± ÙˆØ³Ø· Ù†ÙˆØ§Ø± */
            width: 24px;
            height: 24px;
            background: #fff;
            border-radius: 50%;
            border: 2px solid #667eea;
            /* Ø±Ù†Ú¯ÛŒ Ø§Ø² Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø§ØµÙ„ÛŒ ØµÙØ­Ù‡ */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s ease;
        }

        #mood-slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            background: #fff;
            border-radius: 50%;
            border: 2px solid #667eea;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s ease;
        }

        /* 4. Ø§ÙÚ©Øª Ù‡Ø§ÙˆØ± Ø¨Ø±Ø§ÛŒ Ø¯Ø³ØªÚ¯ÛŒØ±Ù‡ */
        #mood-slider:hover::-webkit-slider-thumb {
            transform: scale(1.1);
        }

        #mood-slider:hover::-moz-range-thumb {
            transform: scale(1.1);
        }

        /* 1. Ø±ÛŒØ³Øª Ú©Ø±Ø¯Ù† Ùˆ ØªÙ†Ø¸ÛŒÙ… Ø¬Ù‡Øª Ø§Ø³Ù„Ø§ÛŒØ¯Ø± */
        #mood-slider {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            background: transparent;
            cursor: pointer;
            height: 24px;

        }
    </style>
</head>

<body>
    <div class="container">
        <div class="text-center mb-3 mt-2">
            <h1 class="display-6 fw-bold text-white">ğŸŒ… Ø­Ø§Ù„ Ù…Ù† ğŸŒ™</h1>
            <p class="text-white-75 small">Ù‡Ø± Ù„Ø­Ø¸Ù‡ØŒ Ø­Ø§Ù„ Ø®ÙˆØ¯Øª Ø±Ùˆ Ø«Ø¨Øª Ú©Ù† Ùˆ Ø±ÙˆÙ†Ø¯Øª Ø±Ùˆ Ø¨Ø¨ÛŒÙ†!</p>
        </div>

        <div class="card p-3">
            <div class="text-center">
                <img id="mood-img" class="mood-img" src="" alt="ØªØµÙˆÛŒØ± Ø­Ø§Ù„">
                <p>Ø§Ù„Ø§Ù† Ø­Ø§Ù„Øª Ú†Ø·ÙˆØ±Ù‡ØŸ</p>
                <div class="slider-container" style="direction: ltr;">
                    <input type="range" id="mood-slider" min="0" max="4" value="2" step="1" class="form-range">
                    <div class="d-flex justify-content-between text-muted small">
                        <span class="mood-label">Ø§ÙØªØ¶Ø§Ø­</span>
                        <span class="mood-label">Ø¨Ø¯</span>
                        <span class="mood-label">Ù…Ø¹Ù…ÙˆÙ„ÛŒ</span>
                        <span class="mood-label">Ø®ÙˆØ¨</span>
                        <span class="mood-label">Ø¹Ø§Ù„ÛŒ</span>
                    </div>
                </div>
                <div id="mood-display" class="mood-display">Ù…Ø¹Ù…ÙˆÙ„ÛŒ</div>
            </div>

            <hr class="my-3">

            <div class="mb-3" style="text-align: center;">
                <h6 class="fw-bold small">Ø¯Ù„ÛŒÙ„ Ø§ÛŒÙ† Ø­Ø§Ù„Øª Ú†ÛŒÙ‡ØŸ</h6>
                <div id="reason-tags" class="mb-2"></div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="reason" id="reason-other" value="other">
                    <label class="form-check-label small" for="reason-other">Ø³Ø§ÛŒØ± (ØªÙˆØ¶ÛŒØ­ Ø¯Ù‡ÛŒØ¯)</label>
                </div>
                <input type="text" id="custom-reason" class="form-control mt-2" placeholder="Ø¯Ù„ÛŒÙ„ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯...">
            </div>

            <div class="mb-3" style="text-align: center; margin: auto;">
                <h6 class="fw-bold small">Ú©ÛŒ Ø§ÛŒÙ†Ø¬ÙˆØ±ÛŒ Ø¨ÙˆØ¯ÛŒØŸ </h6>
                <select id="time-select" class="form-select form-select-sm">
                    <option value="ØµØ¨Ø­">ğŸŒ… ØµØ¨Ø­</option>
                    <option value="Ù…ÛŒØ§Ù†Ù‡ Ø±ÙˆØ²">â˜€ï¸ Ù…ÛŒØ§Ù†Ù‡ Ø±ÙˆØ²</option>
                    <option value="Ø¹ØµØ±">ğŸŒ‡ Ø¹ØµØ±</option>
                    <option value="Ø´Ø¨">ğŸŒ™ Ø´Ø¨</option>
                    <option value="Ù†ÛŒÙ…Ù‡â€ŒØ´Ø¨">ğŸŒŒ Ù†ÛŒÙ…Ù‡â€ŒØ´Ø¨</option>
                </select>
            </div>

            <button id="save-btn" class="btn btn-save w-100 mt-3">
                <i class="fas fa-save"></i> Ø°Ø®ÛŒØ±Ù‡ Ø§ÛŒÙ† Ù„Ø­Ø¸Ù‡
            </button>
        </div>

        <!-- Ø¬Ø¯ÙˆÙ„ Ø±Ú©ÙˆØ±Ø¯Ù‡Ø§ Ø¨Ø§ Pagination -->
        <div class="card p-3">
            <h6 class="mb-2 fw-bold">Ø¢Ø®Ø±ÛŒÙ† Ø±Ú©ÙˆØ±Ø¯Ù‡Ø§</h6>
            <div id="records-table" class="table-responsive small">
                <table class="table table-hover table-sm">
                    <thead>
                        <tr>
                            <th>ØªØ§Ø±ÛŒØ®</th>
                            <th>Ø²Ù…Ø§Ù†</th>
                            <th>Ø­Ø§Ù„Øª</th>
                            <th>Ø¯Ù„ÛŒÙ„</th>
                            <th><i class="fas fa-trash"></i></th>
                        </tr>
                    </thead>
                    <tbody id="records-tbody"></tbody>
                </table>
            </div>
            <nav aria-label="ØµÙØ­Ù‡â€ŒØ¨Ù†Ø¯ÛŒ Ø±Ú©ÙˆØ±Ø¯Ù‡Ø§" class="small">
                <ul id="pagination" class="pagination justify-content-center pagination-sm"></ul>
            </nav>
        </div>

        <div class="text-center mb-3">
            <button id="report-btn" class="btn btn-report w-100">
                <i class="fas fa-chart-pie"></i> Ú¯Ø²Ø§Ø±Ø´ Ú©Ø§Ù…Ù„
            </button>
        </div>

        <!-- Ù…Ø¯Ø§Ù„ Ù…ÙˆÙÙ‚ÛŒØª -->
        <div class="modal fade" id="successModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-sm">
                <div class="modal-content">
                    <div class="modal-header bg-success text-white py-2">
                        <h6 class="modal-title"><i class="fas fa-check-circle"></i> Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯!</h6>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                            aria-label="Close"></button>
                    </div>
                    <div class="modal-body text-center py-3">
                        <i class="fas fa-clipboard-check fa-3x text-success mb-2"></i>
                        <p class="small" id="modal-message">Ø­Ø§Ù„ Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯!</p>
                    </div>
                    <div class="modal-footer py-2">
                        <button type="button" class="btn btn-success btn-sm" data-bs-dismiss="modal">Ø¨Ø§Ø´Ù‡</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ø¨Ø®Ø´ Ú¯Ø²Ø§Ø±Ø´ -->
        <div id="report-section" class="card p-3 mb-4 d-none">
            <h6 class="text-center mb-2 fw-bold"><i class="fas fa-chart-line"></i> Ú¯Ø²Ø§Ø±Ø´ ØªØ­Ù„ÛŒÙ„ÛŒ</h6>

            <ul class="nav nav-tabs small mb-3" id="reportTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active small" id="overview-tab" data-bs-toggle="tab"
                        data-bs-target="#overview" type="button">ğŸ“Š Ú©Ù„ÛŒØ§Øª</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link small" id="timeline-tab" data-bs-toggle="tab" data-bs-target="#timeline"
                        type="button">ğŸ“ˆ Ø±ÙˆÙ†Ø¯</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link small" id="reasons-tab" data-bs-toggle="tab" data-bs-target="#reasons"
                        type="button">ğŸ§  Ø¯Ù„Ø§ÛŒÙ„</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link small" id="daytime-tab" data-bs-toggle="tab" data-bs-target="#daytime"
                        type="button">â° Ø±ÙˆØ²</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link small" id="edit-tab" data-bs-toggle="tab" data-bs-target="#edit"
                        type="button">âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´</button>
                </li>
            </ul>

            <div class="tab-content" id="reportTabsContent">
                <!-- Tab 1: Overview -->
                <div class="tab-pane fade show active" id="overview">
                    <div class="row g-2">
                        <div class="col-12">
                            <div class="chart-container">
                                <h6 class="text-center small">ØªÙˆØ²ÛŒØ¹ Ø­Ø§Ù„Ø§Øª â€” Ø¨Ø§ Ø¯Ø±ØµØ¯ Ùˆ Ø¬Ø²Ø¦ÛŒØ§Øª</h6>
                                <canvas id="mood-pie-chart" class="chart-small"></canvas>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="chart-container">
                                <h6 class="text-center small">Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ</h6>
                                <div id="stats-summary" class="text-center small"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab 2: Timeline -->
                <div class="tab-pane fade" id="timeline">
                    <div class="chart-container">
                        <h6 class="text-center small">Ø±ÙˆÙ†Ø¯ ØªØºÛŒÛŒØ±Ø§Øª Ø­Ø§Ù„</h6>
                        <canvas id="mood-line-chart" class="chart-small"></canvas>
                    </div>
                </div>

                <!-- Tab 3: Reasons per Mood -->
                <div class="tab-pane fade" id="reasons">
                    <div class="row g-2" id="mood-reason-charts">
                        <!-- Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§ÛŒ Ø¯Ù„Ø§ÛŒÙ„ Ø§ÛŒÙ†Ø¬Ø§ Ø±Ù†Ø¯Ø± Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ â€” ÙÙ‚Ø· Ù‡Ù†Ú¯Ø§Ù… Ø¨Ø§Ø² Ø´Ø¯Ù† ØªØ¨ -->
                    </div>
                </div>

                <!-- Tab 4: Day Time Analysis -->
                <div class="tab-pane fade" id="daytime">
                    <div class="row g-2">
                        <div class="col-12">
                            <div class="chart-container">
                                <h6 class="text-center small">ØªÙˆØ²ÛŒØ¹ Ø«Ø¨Øªâ€ŒÙ‡Ø§ Ø¯Ø± Ø³Ø§Ø¹Ø§Øª Ø±ÙˆØ²</h6>
                                <canvas id="time-of-day-chart" class="chart-small"></canvas>
                            </div>
                        </div>
                        <div class="col-12" id="time-mood-charts">
                            <!-- Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§ÛŒ Ø­Ø§Ù„Ø§Øª Ø¯Ø± Ù‡Ø± Ø²Ù…Ø§Ù† Ø±ÙˆØ² Ø§ÛŒÙ†Ø¬Ø§ Ø±Ù†Ø¯Ø± Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ â€” ÙÙ‚Ø· Ù‡Ù†Ú¯Ø§Ù… Ø¨Ø§Ø² Ø´Ø¯Ù† ØªØ¨ -->
                        </div>
                    </div>
                </div>

                <!-- Tab 5: Edit -->
                <div class="tab-pane fade" id="edit">
                    <h6 class="mb-2 fw-bold small">Ù‡Ù…Ù‡ Ø±Ú©ÙˆØ±Ø¯Ù‡Ø§</h6>
                    <div id="full-records-list" class="list-group small"></div>
                </div>
            </div>
        </div>
    </div>
    <div style="text-align: center;">
        <p>Ø·Ø±Ø§Ø­ÛŒ Ùˆ Ø§ÛŒØ¯Ù‡ : Ø­Ø§Ù…Ø¯ Ø®Ø§Ù†Ù‡ Ù¾Ø² - 1404</p>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Main Script -->
    <script>
        // ========== ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ÙˆÙ„ÛŒÙ‡ ==========
        const moods = ["Ø§ÙØªØ¶Ø§Ø­", "Ø¨Ø¯", "Ù…Ø¹Ù…ÙˆÙ„ÛŒ", "Ø®ÙˆØ¨", "Ø¹Ø§Ù„ÛŒ"];
        const moodColors = ["#d9534f", "#f0ad4e", "#ffc107", "#5cb85c", "#28a745"];
        const moodImages = [
            "1.png", // Ø§ÙØªØ¶Ø§Ø­
            "2.png", // Ø¨Ø¯
            "3.png", // Ù…Ø¹Ù…ÙˆÙ„ÛŒ
            "4.png", // Ø®ÙˆØ¨
            "5.png"  // Ø¹Ø§Ù„ÛŒ
        ];

        const reasons = [
            "Ù…Ø­ÛŒØ· Ú©Ø§Ø±", "Ù…Ø­ÛŒØ· Ø®ÙˆÙ†Ù‡", "Ø²Ù†Ø¯Ú¯ÛŒ Ø²Ù†Ø§Ø´ÙˆÛŒÛŒ", "Ø¯Ø®Ù„ Ùˆ Ø®Ø±Ø¬", "Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ",
            "Ø¯ÙˆØ³ØªØ§Ù†", "Ø³Ù„Ø§Ù…ØªÛŒ", "ØªØ±Ø§ÙÛŒÚ©", "Ø®ÙˆØ§Ø¨ Ø¨Ø¯", "Ø®Ø³ØªÚ¯ÛŒ", "Ù…Ø±ÛŒØ¶ÛŒ", "Ø§Ø³ØªØ±Ø³", "ØªÙ†Ù‡Ø§ÛŒÛŒ", "Ø®Ø§Ù„Ù‡ Ø²Ù†Ú© Ø¨Ø§Ø²ÛŒ"
        ];

        const timesOfDay = ["ØµØ¨Ø­", "Ù…ÛŒØ§Ù†Ù‡ Ø±ÙˆØ²", "Ø¹ØµØ±", "Ø´Ø¨", "Ù†ÛŒÙ…Ù‡â€ŒØ´Ø¨"];
        const timeColors = ["#FFB3BA", "#FFDFBA", "#FFFFBA", "#BAFFC9", "#BAE1FF"];

        // ========== Ø§Ù„Ù…Ù†Øªâ€ŒÙ‡Ø§ ==========
        const slider = document.getElementById('mood-slider');
        const moodDisplay = document.getElementById('mood-display');
        const moodImg = document.getElementById('mood-img');
        const reasonTags = document.getElementById('reason-tags');
        const reasonOther = document.getElementById('reason-other');
        const customReason = document.getElementById('custom-reason');
        const saveBtn = document.getElementById('save-btn');
        const reportBtn = document.getElementById('report-btn');
        const reportSection = document.getElementById('report-section');
        const recordsTbody = document.getElementById('records-tbody');
        const paginationEl = document.getElementById('pagination');
        const moodReasonCharts = document.getElementById('mood-reason-charts');
        const fullRecordsList = document.getElementById('full-records-list');
        const timeMoodCharts = document.getElementById('time-mood-charts');

        const successModal = new bootstrap.Modal(document.getElementById('successModal'));
        const modalMessage = document.getElementById('modal-message');

        // ========== Ø±Ù†Ø¯Ø± ØªÚ¯â€ŒÙ‡Ø§ÛŒ Ø¯Ù„ÛŒÙ„ ==========
        reasons.forEach(reason => {
            const tag = document.createElement('span');
            tag.className = 'reason-tag'; // â† Ø­Ø°Ù 'badge' Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø±Ù†Ú¯ Ø³ÙÛŒØ¯
            tag.textContent = reason;
            tag.dataset.value = reason;
            tag.addEventListener('click', function () {
                document.querySelectorAll('.reason-tag').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                reasonOther.checked = false;
                customReason.style.display = 'none';
            });
            reasonTags.appendChild(tag);
        });

        reasonOther.addEventListener('change', function () {
            if (this.checked) {
                customReason.style.display = 'block';
                customReason.focus();
                document.querySelectorAll('.reason-tag').forEach(t => t.classList.remove('active'));
            }
        });

        // ========== Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø­Ø§Ù„ ==========
        function updateMoodDisplay() {
            const index = slider.value;
            moodDisplay.textContent = moods[index];
            moodDisplay.style.color = moodColors[index];
            moodImg.src = moodImages[index];
        }

        slider.addEventListener('input', updateMoodDisplay);
        updateMoodDisplay();

        // ========== Pagination State ==========
        let currentPage = 1;
        const recordsPerPage = 10;

        // ========== Ø°Ø®ÛŒØ±Ù‡ Ø±Ú©ÙˆØ±Ø¯ â€” Ø¨Ø¯ÙˆÙ† Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø²Ù…Ø§Ù† ==========
        saveBtn.addEventListener('click', () => {
            const moodIndex = slider.value;
            const mood = moods[moodIndex];
            const time = document.getElementById('time-select').value;
            const date = new Date().toISOString().split('T')[0]; // YYYY-MM-DD

            let selectedReason = '';
            const activeTag = document.querySelector('.reason-tag.active');
            if (activeTag) {
                selectedReason = activeTag.dataset.value;
            } else if (reasonOther.checked && customReason.value.trim()) {
                selectedReason = customReason.value.trim();
            } else {
                alert("Ù„Ø·ÙØ§Ù‹ ÛŒÚ© Ø¯Ù„ÛŒÙ„ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.");
                return;
            }

            // âš ï¸ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ø§ÛŒÙ†Ú©Ù‡ records ÛŒÚ© Ø¢Ø±Ø§ÛŒÙ‡ Ø§Ø³Øª
            let records = JSON.parse(localStorage.getItem('moodRecords') || '[]');
            if (!Array.isArray(records)) {
                records = [];
            }

            records.push({
                date: date,
                time: time,
                mood: mood,
                reason: selectedReason,
                timestamp: new Date().toISOString()
            });

            localStorage.setItem('moodRecords', JSON.stringify(records));

            // Ø±ÛŒØ³Øª ÙØ±Ù…
            slider.value = 2;
            updateMoodDisplay();
            document.querySelectorAll('.reason-tag').forEach(t => t.classList.remove('active'));
            reasonOther.checked = false;
            customReason.style.display = 'none';
            customReason.value = '';

            // Ù†Ù…Ø§ÛŒØ´ Ù…Ø¯Ø§Ù„ Ù…ÙˆÙÙ‚ÛŒØª
            modalMessage.textContent = `Ø­Ø§Ù„ (${time}) â€” ${mood} Ø¨Ø§ Ø¯Ù„ÛŒÙ„ Â«${selectedReason}Â» Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.`;
            successModal.show();

            // Ø¨Ø§Ø²Ø®ÙˆØ§Ù†ÛŒ Ø¬Ø¯ÙˆÙ„
            loadRecordsTable(1);
        });

        // ========== Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¬Ø¯ÙˆÙ„ Ø±Ú©ÙˆØ±Ø¯Ù‡Ø§ ==========
        function loadRecordsTable(page = 1) {
            currentPage = page;
            let records = JSON.parse(localStorage.getItem('moodRecords') || '[]');

            // âš ï¸ Ù…Ù‡Ø§Ø¬Ø±Øª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ (Ø¢Ø¨Ø¬Ú©Øª â†’ Ø¢Ø±Ø§ÛŒÙ‡)
            if (records !== null && typeof records === 'object' && !Array.isArray(records)) {
                const migrated = [];
                for (let date in records) {
                    for (let time in records[date]) {
                        migrated.push({
                            date: date,
                            time: time,
                            mood: records[date][time].mood,
                            reason: records[date][time].reason,
                            timestamp: records[date][time].timestamp || new Date().toISOString()
                        });
                    }
                }
                records = migrated;
                localStorage.setItem('moodRecords', JSON.stringify(records));
            }

            // Ø§Ú¯Ø± Ù‡Ù†ÙˆØ² Ø¢Ø±Ø§ÛŒÙ‡ Ù†Ø¨ÙˆØ¯ â€” Ø¢Ø±Ø§ÛŒÙ‡ Ø®Ø§Ù„ÛŒ Ø¨Ø³Ø§Ø²
            if (!Array.isArray(records)) {
                records = [];
            }

            // Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ§Ø±ÛŒØ® (Ø¬Ø¯ÛŒØ¯ØªØ±ÛŒÙ† Ø§ÙˆÙ„)
            const sortedData = [...records].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

            // Ù¾Ø§Ú¯ÛŒÙ†ÛŒØ´Ù†
            const startIndex = (page - 1) * recordsPerPage;
            const endIndex = startIndex + recordsPerPage;
            const paginatedData = sortedData.slice(startIndex, endIndex);
            const totalPages = Math.ceil(records.length / recordsPerPage);

            // Ø±Ù†Ø¯Ø± Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§
            recordsTbody.innerHTML = '';
            if (paginatedData.length === 0) {
                recordsTbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="text-center text-muted py-3">Ù‡Ù†ÙˆØ² Ø±Ú©ÙˆØ±Ø¯ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</td>
                    </tr>
                `;
            } else {
                paginatedData.forEach((item, index) => {
                    const row = document.createElement('tr');
                    const moodColor = moodColors[moods.indexOf(item.mood)];
                    row.innerHTML = `
                        <td class="small">${item.date}</td>
                        <td class="small">${item.time}</td>
                        <td><span class="mood-badge" style="background:${moodColor}; color:white;">${item.mood}</span></td>
                        <td class="small">${item.reason}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-danger delete-record" data-index="${startIndex + index}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    recordsTbody.appendChild(row);
                });

                // Ø§ÛŒÙˆÙ†Øª Ø­Ø°Ù
                document.querySelectorAll('.delete-record').forEach(btn => {
                    btn.addEventListener('click', function () {
                        const index = parseInt(this.dataset.index);
                        if (confirm("Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù†ÛŒØ¯ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§ÛŒÙ† Ø±Ú©ÙˆØ±Ø¯ Ø±Ø§ Ø­Ø°Ù Ú©Ù†ÛŒØ¯ØŸ")) {
                            let records = JSON.parse(localStorage.getItem('moodRecords') || '[]');
                            if (!Array.isArray(records)) records = [];
                            records.splice(index, 1);
                            localStorage.setItem('moodRecords', JSON.stringify(records));
                            loadRecordsTable(currentPage);
                            generateReports();
                            // Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§ ÙÙ‚Ø· Ø¯Ø± ØªØ¨â€ŒÙ‡Ø§ Ø±Ù†Ø¯Ø± Ù…ÛŒâ€ŒØ´Ù† â€” Ù¾Ø³ Ù†ÛŒØ§Ø²ÛŒ Ø¨Ù‡ generateReports Ú©Ù„ÛŒ Ù†ÛŒØ³Øª
                        }
                    });
                });
            }

            renderPagination(totalPages, page);
        }

        function renderPagination(totalPages, currentPage) {
            paginationEl.innerHTML = '';
            if (totalPages <= 1) return;

            const prevItem = document.createElement('li');
            prevItem.className = `page-item ${currentPage === 1 ? 'disabled' : ''}`;
            prevItem.innerHTML = `<a class="page-link" href="#">Â«</a>`;
            if (currentPage > 1) {
                prevItem.addEventListener('click', (e) => {
                    e.preventDefault();
                    loadRecordsTable(currentPage - 1);
                });
            }
            paginationEl.appendChild(prevItem);

            const startPage = Math.max(1, currentPage - 1);
            const endPage = Math.min(totalPages, currentPage + 1);

            for (let i = startPage; i <= endPage; i++) {
                const item = document.createElement('li');
                item.className = `page-item ${i === currentPage ? 'active' : ''}`;
                item.innerHTML = `<a class="page-link" href="#">${i}</a>`;
                if (i !== currentPage) {
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        loadRecordsTable(i);
                    });
                }
                paginationEl.appendChild(item);
            }

            const nextItem = document.createElement('li');
            nextItem.className = `page-item ${currentPage === totalPages ? 'disabled' : ''}`;
            nextItem.innerHTML = `<a class="page-link" href="#">Â»</a>`;
            if (currentPage < totalPages) {
                nextItem.addEventListener('click', (e) => {
                    e.preventDefault();
                    loadRecordsTable(currentPage + 1);
                });
            }
            paginationEl.appendChild(nextItem);
        }

        // ========== Ù†Ù…Ø§ÛŒØ´ Ú¯Ø²Ø§Ø±Ø´ ==========
        reportBtn.addEventListener('click', () => {
            reportSection.classList.remove('d-none');
            generateReports();
        });

        // ========== ØªÙˆÙ„ÛŒØ¯ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ (Ú©Ù„ÛŒØ§Øª + Ø±ÙˆÙ†Ø¯ + Ø¢Ù…Ø§Ø± + Ù„ÛŒØ³Øª Ú©Ø§Ù…Ù„) ==========
        function generateReports() {
            let records = JSON.parse(localStorage.getItem('moodRecords') || '[]');

            // âš ï¸ Ù…Ù‡Ø§Ø¬Ø±Øª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ (Ø¢Ø¨Ø¬Ú©Øª â†’ Ø¢Ø±Ø§ÛŒÙ‡)
            if (records !== null && typeof records === 'object' && !Array.isArray(records)) {
                const migrated = [];
                for (let date in records) {
                    for (let time in records[date]) {
                        migrated.push({
                            date: date,
                            time: time,
                            mood: records[date][time].mood,
                            reason: records[date][time].reason,
                            timestamp: records[date][time].timestamp || new Date().toISOString()
                        });
                    }
                }
                records = migrated;
                localStorage.setItem('moodRecords', JSON.stringify(records));
            }

            // Ø§Ú¯Ø± Ù‡Ù†ÙˆØ² Ø¢Ø±Ø§ÛŒÙ‡ Ù†Ø¨ÙˆØ¯ â€” Ø¢Ø±Ø§ÛŒÙ‡ Ø®Ø§Ù„ÛŒ Ø¨Ø³Ø§Ø²
            if (!Array.isArray(records)) {
                records = [];
            }

            if (records.length === 0) {
                document.getElementById('stats-summary').innerHTML = '<p class="text-muted">Ù‡Ù†ÙˆØ² Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ ØªØ­Ù„ÛŒÙ„ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.</p>';
                fullRecordsList.innerHTML = '<div class="list-group-item text-center text-muted py-3">Ù‡Ù†ÙˆØ² Ø±Ú©ÙˆØ±Ø¯ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</div>';
                return;
            }

            // ========== Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ù„ÛŒ ==========
            const moodCounts = {};
            moods.forEach(m => moodCounts[m] = 0);

            records.forEach(item => {
                moodCounts[item.mood]++;
            });

            // ========== Ù†Ù…ÙˆØ¯Ø§Ø± Ø¯Ø§ÛŒØ±Ù‡â€ŒØ§ÛŒ Ú©Ù„ÛŒ Ø­Ø§Ù„Ø§Øª ==========
            const total = records.length;
            const labels = moods.map(m => `${m} (${moodCounts[m]} - ${total ? Math.round((moodCounts[m] / total) * 100) : 0}%)`);
            const data = moods.map(m => moodCounts[m]);
            renderPieChart('mood-pie-chart', labels, data, moodColors);

            // ========== Ù†Ù…ÙˆØ¯Ø§Ø± Ø®Ø·ÛŒ ==========
            const sortedData = [...records].sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
            const lineLabels = sortedData.map(d => {
                const dDate = new Date(d.date);
                return `${dDate.getMonth() + 1}/${dDate.getDate()}`;
            });
            const lineData = sortedData.map(d => moods.indexOf(d.mood));
            renderLineChart('mood-line-chart', lineLabels, lineData, '#4e73df');

            // ========== Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ ==========
            const totalRecords = records.length;
            const avgMood = totalRecords > 0 ? (records.reduce((sum, d) => sum + moods.indexOf(d.mood), 0) / totalRecords).toFixed(2) : 0;
            const bestMoodDays = records.filter(d => d.mood === "Ø¹Ø§Ù„ÛŒ").length;
            const worstMoodDays = records.filter(d => d.mood === "Ø§ÙØªØ¶Ø§Ø­").length;

            document.getElementById('stats-summary').innerHTML = `
                <p class="mb-1"><strong>Ú©Ù„ Ø±Ú©ÙˆØ±Ø¯Ù‡Ø§:</strong> ${totalRecords}</p>
                <p class="mb-1"><strong>Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø­Ø§Ù„:</strong> ${avgMood}/4</p>
                <p class="mb-1"><strong>Ø±ÙˆØ²Ù‡Ø§ÛŒ Ø¹Ø§Ù„ÛŒ:</strong> ${bestMoodDays}</p>
                <p class="mb-1"><strong>Ø±ÙˆØ²Ù‡Ø§ÛŒ Ø§ÙØªØ¶Ø§Ø­:</strong> ${worstMoodDays}</p>
            `;

            // ========== Ù„ÛŒØ³Øª Ú©Ø§Ù…Ù„ Ø±Ú©ÙˆØ±Ø¯Ù‡Ø§ ==========
            fullRecordsList.innerHTML = '';
            if (records.length === 0) {
                fullRecordsList.innerHTML = '<div class="list-group-item text-center text-muted py-3">Ù‡Ù†ÙˆØ² Ø±Ú©ÙˆØ±Ø¯ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</div>';
            } else {
                [...records].reverse().forEach((item, index) => {
                    const itemEl = document.createElement('div');
                    itemEl.className = 'list-group-item d-flex justify-content-between align-items-center py-2';
                    const moodColor = moodColors[moods.indexOf(item.mood)];
                    itemEl.innerHTML = `
                        <div>
                            <div class="small fw-bold">${item.date} - ${item.time}</div>
                            <span class="badge" style="background:${moodColor}; color:white; font-size:0.85em;">${item.mood}</span>
                            <div class="text-muted small mt-1">${item.reason}</div>
                        </div>
                        <button class="btn btn-sm btn-outline-danger delete-full-record" data-index="${records.length - 1 - index}">
                            <i class="fas fa-trash"></i>
                        </button>
                    `;
                    fullRecordsList.appendChild(itemEl);
                });

                document.querySelectorAll('.delete-full-record').forEach(btn => {
                    btn.addEventListener('click', function () {
                        const index = parseInt(this.dataset.index);
                        if (confirm("Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù†ÛŒØ¯ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§ÛŒÙ† Ø±Ú©ÙˆØ±Ø¯ Ø±Ø§ Ø­Ø°Ù Ú©Ù†ÛŒØ¯ØŸ")) {
                            let records = JSON.parse(localStorage.getItem('moodRecords') || '[]');
                            if (!Array.isArray(records)) records = [];
                            records.splice(index, 1);
                            localStorage.setItem('moodRecords', JSON.stringify(records));
                            this.closest('.list-group-item').remove();
                            generateReports();
                            loadRecordsTable(currentPage);
                            generateReports();
                        }
                    });
                });
            }
        }

        // ========== ØªÙˆØ§Ø¨Ø¹ Ù†Ù…ÙˆØ¯Ø§Ø± ==========
        function renderPieChart(id, labels, data, colors) {
            const canvas = document.getElementById(id);
            if (!canvas) return;

            const ctx = canvas.getContext('2d');

            // Ø§Ú¯Ø± Ù†Ù…ÙˆØ¯Ø§Ø± Ù‚Ø¨Ù„ÛŒ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø´ØªØŒ Ø§Ø¨ØªØ¯Ø§ destroy Ú©Ù†
            if (window[id + 'Chart']) {
                window[id + 'Chart'].destroy();
            }

            // Ù†Ù…ÙˆØ¯Ø§Ø± Ø¬Ø¯ÛŒØ¯
            window[id + 'Chart'] = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data,
                        backgroundColor: colors,
                        borderWidth: 2,
                        borderColor: '#fff',
                        hoverOffset: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                font: {
                                    size: 12
                                },
                                padding: 16
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    return `${context.label}: ${context.raw} Ø¨Ø§Ø±`;
                                }
                            }
                        }
                    }
                }
            });

            // âœ… Ø±Ø§Ù‡â€ŒØ­Ù„ Ø§ØµÙ„ÛŒ: Ø¨Ø¹Ø¯ Ø§Ø² 100ms ÛŒÚ© resize Ø§Ø¬Ø±Ø§ Ú©Ù† â€” ØªØ§ Ù†Ù…ÙˆØ¯Ø§Ø± Ù…ÙˆÙ‚Ø¹ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø±Ø³Øª Ø´Ú©Ù„ Ø¨Ú¯ÛŒØ±Ù‡
            setTimeout(() => {
                if (window[id + 'Chart']) {
                    window[id + 'Chart'].resize();
                }
            }, 100);
        }

        function renderLineChart(id, labels, data, color) {
            const ctx = document.getElementById(id).getContext('2d');
            if (window[id + 'Chart']) window[id + 'Chart'].destroy();
            window[id + 'Chart'] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Ù…ÛŒØ²Ø§Ù† Ø­Ø§Ù„',
                        data: data,
                        borderColor: color,
                        backgroundColor: color + '20',
                        borderWidth: 2,
                        pointRadius: 3,
                        pointBackgroundColor: color,
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            min: 0,
                            max: 4,
                            ticks: {
                                stepSize: 1,
                                font: {
                                    size: 11
                                },
                                callback: function (value) {
                                    return moods[value] || value;
                                }
                            },
                            grid: {
                                display: true
                            }
                        },
                        x: {
                            ticks: {
                                font: {
                                    size: 10
                                }
                            },
                            grid: {
                                display: false
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            labels: {
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    return `Ø­Ø§Ù„: ${moods[context.raw]} (${context.raw}/4)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // ========== Ø±Ù†Ø¯Ø± Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§ ÙÙ‚Ø· Ù‡Ù†Ú¯Ø§Ù… Ø¨Ø§Ø² Ø´Ø¯Ù† ØªØ¨ ==========
        document.addEventListener('DOMContentLoaded', function () {
            loadRecordsTable(1);

            // ØªØ¨ Ø¯Ù„Ø§ÛŒÙ„
            document.getElementById('reasons-tab').addEventListener('shown.bs.tab', function () {
                setTimeout(() => {
                    const records = JSON.parse(localStorage.getItem('moodRecords') || '[]');
                    if (!Array.isArray(records)) return;

                    const moodReasonMap = {};
                    records.forEach(item => {
                        if (!moodReasonMap[item.mood]) moodReasonMap[item.mood] = {};
                        moodReasonMap[item.mood][item.reason] = (moodReasonMap[item.mood][item.reason] || 0) + 1;
                    });

                    const moodReasonCharts = document.getElementById('mood-reason-charts');
                    moodReasonCharts.innerHTML = '';
                    moods.forEach(mood => {
                        if (!moodReasonMap[mood] || Object.keys(moodReasonMap[mood]).length === 0) return;

                        const col = document.createElement('div');
                        col.className = 'col-12 mb-3';
                        col.innerHTML = `
                            <div class="chart-container">
                                <h6 class="text-center small">Ø¯Ù„Ø§ÛŒÙ„ "${mood}"</h6>
                                <canvas id="chart-${mood.replace(/\s+/g, '-')}"></canvas>
                            </div>
                        `;
                        moodReasonCharts.appendChild(col);

                        const reasonEntries = Object.entries(moodReasonMap[mood])
                            .sort((a, b) => b[1] - a[1])
                            .slice(0, 6);
                        const labels = reasonEntries.map(r => r[0]);
                        const data = reasonEntries.map(r => r[1]);

                        const colors = labels.map((_, i) => {
                            const hue = (i * 137) % 360;
                            return `hsl(${hue}, 70%, 60%)`;
                        });

                        setTimeout(() => {
                            renderPieChart(
                                `chart-${mood.replace(/\s+/g, '-')}`,
                                labels,
                                data,
                                colors
                            );
                        }, 150);
                    });
                }, 100);
            });

            // ØªØ¨ Ø±ÙˆØ²
            document.getElementById('daytime-tab').addEventListener('shown.bs.tab', function () {
                setTimeout(() => {
                    const records = JSON.parse(localStorage.getItem('moodRecords') || '[]');
                    if (!Array.isArray(records)) return;

                    const timeCounts = {};
                    const timeMoodMap = {};

                    records.forEach(item => {
                        timeCounts[item.time] = (timeCounts[item.time] || 0) + 1;
                        if (!timeMoodMap[item.time]) timeMoodMap[item.time] = {};
                        timeMoodMap[item.time][item.mood] = (timeMoodMap[item.time][item.mood] || 0) + 1;
                    });

                    // Ù†Ù…ÙˆØ¯Ø§Ø± Ú©Ù„ÛŒ Ø³Ø§Ø¹Ø§Øª Ø±ÙˆØ²
                    const timeLabels = timesOfDay.map(t => `${t} (${timeCounts[t] || 0})`);
                    const timeData = timesOfDay.map(t => timeCounts[t] || 0);
                    renderPieChart('time-of-day-chart', timeLabels, timeData, timeColors);

                    // Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§ÛŒ Ø­Ø§Ù„Ø§Øª Ø¯Ø± Ù‡Ø± Ø²Ù…Ø§Ù†
                    const timeMoodCharts = document.getElementById('time-mood-charts');
                    timeMoodCharts.innerHTML = '';
                    timesOfDay.forEach(time => {
                        if (!timeMoodMap[time] || Object.keys(timeMoodMap[time]).length === 0) return;

                        const col = document.createElement('div');
                        col.className = 'col-12 mb-3';
                        col.innerHTML = `
                            <div class="chart-container">
                                <h6 class="text-center small">Ø­Ø§Ù„Ø§Øª Ø¯Ø± "${time}"</h6>
                                <canvas id="chart-time-${time.replace(/\s+/g, '-')}"></canvas>
                            </div>
                        `;
                        timeMoodCharts.appendChild(col);

                        const moodEntries = Object.entries(timeMoodMap[time]);
                        const labels = moodEntries.map(e => e[0]);
                        const data = moodEntries.map(e => e[1]);
                        const colors = labels.map(m => moodColors[moods.indexOf(m)]);

                        setTimeout(() => {
                            renderPieChart(
                                `chart-time-${time.replace(/\s+/g, '-')}`,
                                labels,
                                data,
                                colors
                            );
                        }, 150);
                    });
                }, 100);
            });
        });
    </script>
    <script>
        if ('serviceWorker' in navigator) {
          window.addEventListener('load', () => {
            navigator.serviceWorker.register('/service-worker.js')
              .then(registration => {
                console.log('ServiceWorker registration successful with scope: ', registration.scope);
              })
              .catch(err => {
                console.log('ServiceWorker registration failed: ', err);
              });
          });
        }
      </script>
</body>

</html>
